<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Slinky</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link href="https://vjs.zencdn.net/7.19.2/video-js.css" rel="stylesheet"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"
          integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g=="
          crossorigin="anonymous" referrerpolicy="no-referrer"/>
    <style>
        #remote {
            /*background: #e5e5e5;*/
            border-radius: 30px;
        }
        #remote button span {
            font-size: 80%;
        }
        .small_icon {
            font-size: 6px;
        }
    </style>
</head>
<body onload="checkStatus()">
<h1>Slinky</h1>
<div class="container">
    <div class="row">
        <div class="col-xxl-10 col-xl-10 col-lg-10 col-md-12 col-sm-12 col-xs-12">
            <video id="slinky-video" class="video-js" controls preload="auto" width="640" height="264"
                   poster="MY_VIDEO_POSTER.jpg" data-setup="{}">
                <source
                        src="http://localhost:8081/video"
                        type="application/x-mpegURL">
                <p class="vjs-no-js">
                    To view this video please enable JavaScript, and consider upgrading to a
                    web browser that
                    <a href="https://videojs.com/html5-video-support/" target="_blank"
                    >supports HTML5 video</a
                    >
                </p>
            </video>

        </div>
        <div class="col" id="remote">
            <div class="row align-items-center justify-content-left mb-2">
                <div class="col-7 m-0 p-1">
                    <button type="button" class="btn btn-outline-secondary col-12" id="power">
                        <i class="fas fa-power-off active" style="color: #ffffff;"></i>
                    </button>
                </div>
                <div class="col-4 ms-auto m-0 p-1">
                    <button type="button" class="btn btn-outline-secondary col-12" id="mute">
                        <i class="fas fa-volume-mute"></i>
                    </button>
                </div>
            </div>
            <div class="row">
                <div class="col-4 d-flex justify-content-center m-0 p-1">
                    <button type="button" class="btn btn-outline-secondary col-12" id="rewind">
                        <i class="fa-solid fa-backward"></i></button>
                </div>
                <div class="col-4 d-flex justify-content-center m-0 p-1">
                    <button type="button" class="btn btn-outline-secondary col-12" id="play">
                        <i class="fa-solid fa-play"></i>
                        <i class="fa-solid fa-pause"></i></button>
                </div>
                <div class="col-4 d-flex justify-content-center m-0 p-1">
                    <button type="button" class="btn btn-outline-secondary col-12" id="fast-forward">
                        <i class="fa-solid fa-forward"></i></button>
                    </button>
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-4 d-flex justify-content-center m-0 p-1">
                    <button type="button" class="btn btn-outline-secondary col-12" id="record">
                        <i class="fa-solid fa-circle" style="color: red"></i>
                    </button>
                </div>
                <div class="col-4 ms-auto d-flex justify-content-center m-0 p-1">
                    <button type="button" class="btn btn-outline-secondary col-12" id="info">
                        <i class="fa-solid fa-info"></i>
                    </button>
                </div>
                <div class="col-4 ms-auto d-flex justify-content-center m-0 p-1">
                    <button type="button" class="btn btn-outline-secondary col-12" id="search">
                        <i class="fa-solid fa-magnifying-glass"></i>
                    </button>
                </div>
            </div>
            <div class="row">
                <div class="col-5 d-flex justify-content-center">
                    <button type="button" class="btn btn-outline-secondary input-block-level" id="volume-up">
                        <i class="fas fa-plus"></i><span class="desc"><br/>Vol</span>
                    </button>
                </div>
                <div class="col-5 ms-auto d-flex justify-content-center">
                    <button type="button" class="btn btn-outline-secondary input-block-level" id="channel-up">
                        <i class="fas fa-chevron-up"></i><span class="desc"><br/>Ch</span>
                    </button>

                </div>
            </div>
            <div class="row mb-3">
                <div class="col-5 d-flex justify-content-center">
                    <button type="button" class="btn btn-outline-secondary" id="volume-down">
                        <span class="desc">Vol<br/></span><i class="fas fa-minus"></i>
                    </button>
                </div>
                <div class="col-5 ms-auto d-flex justify-content-center">
                    <button type="button" class="btn btn-outline-secondary" id="channel-down">
                        <span class="desc">Ch<br/></span><i class="fas fa-chevron-down"></i>
                    </button>
                </div>
            </div>
            <div class="row justify-content-center">
                <div class="col-4 justify-content-center m-0 p-0">
                    <button type="button" class="btn btn-outline-secondary col-12" id="direction-up">
                        <i class="fas fa-chevron-up"></i>
                    </button>
                </div>
            </div>
            <div class="row">
                <div class="col-4 d-flex justify-content-center m-0 p-0">
                    <button type="button" class="btn btn-outline-secondary col-12
" id="direction-left">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                </div>
                <div class="col-4 d-flex justify-content-center m-0 p-0">
                    <button type="button" class="btn btn-outline-secondary col-12" id="select">
                        <i class="fas fa-circle-check"></i>
                    </button>
                </div>
                <div class="col-4 d-flex justify-content-center m-0 p-0">
                    <button type="button" class="btn btn-outline-secondary col-12" id="direction-right">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
            <div class="row  justify-content-center mb-3">
                <div class="col-4 d-flex justify-content-center m-0 p-0">
                    <button type="button" class="btn btn-outline-secondary col-12" id="direction-down">
                        <i class="fas fa-chevron-down"></i>
                    </button>
                </div>
            </div>
            <div class="row align-items-center justify-content-center mb-2">
                <div class="col-6 justify-content-center m-0 p-1">
                    <button type="button" class="btn btn-outline-secondary col-12" id="menu">
                        <i class="fas fa-bars"></i><br /><span class="desc">Menu</span>
                    </button>
                </div>
                <div class="col-6 ms-auto justify-content-center m-0 p-1">
                    <button type="button" class="btn btn-outline-secondary col-12" id="return">
                        <i class="fa-solid fa-arrow-rotate-left"></i><br /><span class="desc">Back</span>
                    </button>
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-3 d-flex justify-content-center m-0 p-1">
                    <button type="button" class="btn btn-outline-secondary m-0 p-0 col-12" id="red">
                        <i class="fa-solid fa-square" style="color: red"></i>
                    </button>
                </div>
                <div class="col-3 d-flex justify-content-center m-0 p-1">
                    <button type="button" class="btn btn-outline-secondary m-0 p-0 col-12" id="green">
                        <i class="fa-solid fa-square" style="color: green"></i>
                    </button>
                </div>
                <div class="col-3 d-flex justify-content-center m-0 p-1">
                    <button type="button" class="btn btn-outline-secondary m-0 p-0 col-12" id="yellow">
                        <i class="fa-solid fa-square" style="color: yellow"></i>
                    </button>
                </div>
                <div class="col-3 d-flex justify-content-center m-0 p-1">
                    <button type="button" class="btn btn-outline-secondary m-0 p-0 col-12" id="blue">
                        <i class="fa-solid fa-square" style="color: blue"></i>
                    </button>
                </div>
            </div>
            <div class="row mb-2">
                <div class="col-12 d-flex justify-content-center m-0 p-1">
                    <div class="input-group mb-3">
                        <input type="number" class="form-control" placeholder="Ch" aria-label="Channel"
                               aria-describedby="ch" id="channel">
                        <button class="btn btn-outline-secondary" type="button" id="ch"><span class="desc">Go</span>
                        </button>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-4 d-flex justify-content-center m-0 p-1">
                    <button type="button" class="btn btn-outline-secondary col-12" id="1">
                        <i class="fa-solid fa-1"></i>
                    </button>
                </div>
                <div class="col-4 ms-auto d-flex justify-content-center m-0 p-1">
                    <button type="button" class="btn btn-outline-secondary col-12" id="2">
                        <i class="fa-solid fa-2"></i>
                    </button>
                </div>
                <div class="col-4 ms-auto d-flex justify-content-center m-0 p-1">
                    <button type="button" class="btn btn-outline-secondary col-12" id="3">
                        <i class="fa-solid fa-3"></i>
                    </button>
                </div>
            </div>
            <div class="row">
                <div class="col-4 d-flex justify-content-center m-0 p-1">
                    <button type="button" class="btn btn-outline-secondary col-12" id="4">
                        <i class="fa-solid fa-4"></i>
                    </button>
                </div>
                <div class="col-4 ms-auto d-flex justify-content-center m-0 p-1">
                    <button type="button" class="btn btn-outline-secondary col-12" id="5">
                        <i class="fa-solid fa-5"></i>
                    </button>
                </div>
                <div class="col-4 ms-auto d-flex justify-content-center m-0 p-1">
                    <button type="button" class="btn btn-outline-secondary col-12" id="6">
                        <i class="fa-solid fa-6"></i>
                    </button>
                </div>
            </div>
            <div class="row">
                <div class="col-4 d-flex justify-content-center m-0 p-1">
                    <button type="button" class="btn btn-outline-secondary col-12" id="7">
                        <i class="fa-solid fa-7"></i>
                    </button>
                </div>
                <div class="col-4 ms-auto d-flex justify-content-center m-0 p-1">
                    <button type="button" class="btn btn-outline-secondary col-12" id="8">
                        <i class="fa-solid fa-8"></i>
                    </button>
                </div>
                <div class="col-4 ms-auto d-flex justify-content-center m-0 p-1">
                    <button type="button" class="btn btn-outline-secondary col-12" id="9">
                        <i class="fa-solid fa-9"></i>
                    </button>
                </div>
            </div>
            <div class="row justify-content-center">
                <div class="col-4 d-flex justify-content-center m-0 p-1">
                    <button type="button" class="btn btn-outline-secondary col-12" id="0">
                        <i class="fa-solid fa-0"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>

<script>
    const remoteCtrl = document.getElementById('remote');
    const apiRoot = "/api/v1"
    const call = apiRoot + "/call"
    const pwrStatus = apiRoot + "/pwr";

    const pwrButton = document.getElementById("power");
    const channel = document.getElementById("channel")

    // Check power status
    const interval = setInterval(function () {
        checkStatus()
    }, 10000)

    function checkStatus() {
        const xmlHttp = new XMLHttpRequest();
        xmlHttp.open("GET", pwrStatus, false); // false for synchronous request
        xmlHttp.send(null);
        const resp = JSON.parse(xmlHttp.responseText)
        const pwrClass = pwrButton.classList;
        if (resp.off === false) {
            pwrClass.add("btn-danger")
            pwrClass.remove("btn-success")
        } else {
            pwrClass.add("btn-success")
            pwrClass.remove("btn-danger")
        }
    }

    function sendCmd(cmd) {
        const xmlHttp = new XMLHttpRequest();
        xmlHttp.open("GET", call + "/" + cmd, false); // false for synchronous request
        xmlHttp.send(null);
        checkStatus();
    }

    remoteCtrl.addEventListener('click', (event) => {
        let id = "";
        if (event.target.nodeName === 'BUTTON') {
            id = event.target.id;
        } else if (event.target.nodeName === 'I') {
            // If it's one of the icons, process its parent
            id = event.target.parentElement.id;
        } else {
            console.log("Returning!")
            return
        }
        if (id === "ch") {
            console.log("Change channel");
        } else {
            // Send the raw request
            console.log("Sending command: " + id)
            sendCmd(id);
        }
    })

    channel.addEventListener('keypress', (event) => {
            if (event.key === "Enter") {
                //console.log(channel.value)
                // Split channel input into separate values
                const nums = channel.value.toString().split('');

                for (let i = 0; i < nums.length; i++) {
                    sendCmd(nums[i])
                    sleep(500);
                }
            }
        }
    )

    function sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }

    window.HELP_IMPROVE_VIDEOJS = false;
</script>
<script src="https://vjs.zencdn.net/7.19.2/video.min.js"></script>
</body>
</html>